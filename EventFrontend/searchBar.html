<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Search Events</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #050810;
      --surface: #0d1120;
      --surface2: #111827;
      --border: rgba(255,255,255,0.08);
      --accent: #00f5c4;
      --accent2: #7b5cf7;
      --text: #e8eaf2;
      --muted: #6b7280;
      --error: #f87171;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 48px 24px;
    }

    body::before {
      content: '';
      position: fixed; inset: 0;
      background-image:
        linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
      background-size: 50px 50px;
      pointer-events: none;
    }

    .orb {
      position: fixed; border-radius: 50%;
      filter: blur(90px); pointer-events: none; opacity: 0.1;
    }
    .orb-1 { width: 400px; height: 400px; background: #7b5cf7; top: -100px; left: -100px; }
    .orb-2 { width: 300px; height: 300px; background: #00f5c4; bottom: -80px; right: -80px; }

    .wrapper {
      max-width: 780px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    /* Header */
    .page-header { text-align: center; margin-bottom: 40px; }
    .logo {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 1.5rem; letter-spacing: 3px;
      color: var(--accent); display: block; margin-bottom: 12px;
    }
    .page-header h1 {
      font-family: 'Bebas Neue', sans-serif;
      font-size: clamp(2rem, 5vw, 3.2rem);
      letter-spacing: 1px; line-height: 1;
      margin-bottom: 8px;
    }
    .page-header h1 span { color: var(--accent); }
    .page-header p { font-size: 0.9rem; color: var(--muted); }

    /* Search box */
    .search-box {
      position: relative;
      margin-bottom: 24px;
    }
    .search-box svg.s-icon {
      position: absolute; left: 18px; top: 50%;
      transform: translateY(-50%);
      width: 20px; height: 20px;
      color: var(--muted); pointer-events: none;
      transition: color 0.2s;
    }
    .search-box:focus-within svg.s-icon { color: var(--accent); }

    #searchInput {
      width: 100%;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 1rem;
      padding: 16px 56px 16px 52px;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    #searchInput:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(0,245,196,0.08);
    }
    #searchInput::placeholder { color: var(--muted); }

    .clear-btn {
      position: absolute; right: 16px; top: 50%;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.06);
      border: none; border-radius: 6px;
      color: var(--muted); cursor: pointer;
      width: 28px; height: 28px;
      display: none; align-items: center; justify-content: center;
      font-size: 1rem; transition: background 0.2s, color 0.2s;
    }
    .clear-btn.visible { display: flex; }
    .clear-btn:hover { background: rgba(255,255,255,0.12); color: var(--text); }

    /* Filter chips */
    .filters {
      display: flex; gap: 8px; flex-wrap: wrap;
      margin-bottom: 28px;
    }
    .chip {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 100px;
      color: var(--muted);
      font-size: 0.82rem; font-weight: 500;
      padding: 6px 16px;
      cursor: pointer;
      transition: all 0.2s;
      user-select: none;
    }
    .chip:hover { border-color: rgba(255,255,255,0.2); color: var(--text); }
    .chip.active {
      background: rgba(0,245,196,0.12);
      border-color: rgba(0,245,196,0.4);
      color: var(--accent);
    }

    /* Results meta */
    .results-meta {
      font-size: 0.82rem; color: var(--muted);
      margin-bottom: 16px;
      min-height: 20px;
    }
    .results-meta span { color: var(--accent); font-weight: 600; }

    /* Cards grid */
    #results {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .event-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 22px 24px;
      display: flex;
      align-items: center;
      gap: 20px;
      cursor: pointer;
      transition: transform 0.25s, border-color 0.25s, box-shadow 0.25s;
      animation: fadeUp 0.4s ease both;
    }
    .event-card:hover {
      transform: translateY(-3px);
      border-color: rgba(0,245,196,0.25);
      box-shadow: 0 16px 40px rgba(0,0,0,0.35), 0 0 30px rgba(0,245,196,0.04);
    }
    @keyframes fadeUp { from{opacity:0;transform:translateY(12px)} to{opacity:1;transform:translateY(0)} }

    /* Date badge */
    .date-badge {
      flex-shrink: 0;
      width: 56px;
      background: rgba(0,245,196,0.08);
      border: 1px solid rgba(0,245,196,0.2);
      border-radius: 12px;
      text-align: center;
      padding: 10px 6px;
    }
    .date-badge .day {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 1.6rem; line-height: 1;
      color: var(--accent);
    }
    .date-badge .mon {
      font-size: 0.68rem; font-weight: 700;
      text-transform: uppercase; letter-spacing: 1px;
      color: var(--muted); margin-top: 2px;
    }

    /* Card body */
    .card-body { flex: 1; min-width: 0; }

    .event-name {
      font-size: 1rem; font-weight: 600;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
      margin-bottom: 8px;
    }

    .meta-row {
      display: flex; flex-wrap: wrap; gap: 14px;
    }
    .meta-item {
      display: flex; align-items: center; gap: 5px;
      font-size: 0.8rem; color: var(--muted);
    }
    .meta-item svg { width: 13px; height: 13px; flex-shrink: 0; }

    /* Category tag */
    .tag {
      flex-shrink: 0;
      font-size: 0.72rem; font-weight: 700;
      letter-spacing: 0.5px; text-transform: uppercase;
      padding: 4px 12px; border-radius: 100px;
    }
    .tag-tech     { background: rgba(123,92,247,0.15); color: #a78bfa; border: 1px solid rgba(123,92,247,0.3); }
    .tag-music    { background: rgba(251,146,60,0.12); color: #fb923c; border: 1px solid rgba(251,146,60,0.3); }
    .tag-business { background: rgba(0,245,196,0.1);  color: var(--accent); border: 1px solid rgba(0,245,196,0.25); }
    .tag-sports   { background: rgba(248,113,113,0.12); color: #f87171; border: 1px solid rgba(248,113,113,0.3); }
    .tag-art      { background: rgba(251,191,36,0.12); color: #fbbf24; border: 1px solid rgba(251,191,36,0.3); }
    .tag-food     { background: rgba(52,211,153,0.12); color: #34d399; border: 1px solid rgba(52,211,153,0.3); }

    /* Empty state */
    .empty {
      text-align: center;
      padding: 60px 24px;
      display: none;
    }
    .empty.show { display: block; }
    .empty-icon { font-size: 3rem; margin-bottom: 16px; }
    .empty h3 { font-size: 1.1rem; font-weight: 600; margin-bottom: 6px; }
    .empty p { font-size: 0.85rem; color: var(--muted); }

    /* highlight match */
    mark {
      background: rgba(0,245,196,0.2);
      color: var(--accent);
      border-radius: 3px;
      padding: 0 2px;
    }

    @media (max-width: 520px) {
      .event-card { flex-wrap: wrap; }
      .tag { align-self: flex-start; }
      .date-badge { width: 48px; }
    }
  </style>
</head>
<body>

<div class="orb orb-1"></div>
<div class="orb orb-2"></div>

<div class="wrapper">

  <div class="page-header">
    <span class="logo">Login To</span>
    <h1>Find Local <span>Events</span></h1>
    <p>Search by event name, location, or category</p>
  </div>

  <!-- Search -->
  <div class="search-box">
    <svg class="s-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
      <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
    </svg>
    <input type="text" id="searchInput" placeholder="Search events, locations, categories‚Ä¶" autocomplete="off"/>
    <button class="clear-btn" id="clearBtn" title="Clear">‚úï</button>
  </div>

  <!-- Filter chips -->
  <div class="filters" id="filters">
    <div class="chip active" data-cat="all">All</div>
    <div class="chip" data-cat="tech">Tech</div>
    <div class="chip" data-cat="music">Music</div>
    <div class="chip" data-cat="business">Business</div>
    <div class="chip" data-cat="sports">Sports</div>
    <div class="chip" data-cat="art">Art</div>
    <div class="chip" data-cat="food">Food</div>
  </div>

  <div class="results-meta" id="meta"></div>

  <div id="results"></div>
  <div class="empty" id="empty">
    <div class="empty-icon">üîç</div>
    <h3>No events found</h3>
    <p>Try a different keyword or category</p>
  </div>

</div>

<script>
  let EVENTS = [];
  let activeFilter = 'all';
  let query = '';

  const resultsEl = document.getElementById('results');
  const emptyEl   = document.getElementById('empty');
  const metaEl    = document.getElementById('meta');
  const input     = document.getElementById('searchInput');
  const clearBtn  = document.getElementById('clearBtn');

  /* ‚îÄ‚îÄ Load events from backend ‚îÄ‚îÄ */
  async function loadEvents() {
    try {
      const res = await fetch('https://hackthonbackend.onrender.com/Event/allEvents', {
        headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
      });
      EVENTS = await res.json();
      render();
    } catch (e) {
      metaEl.innerHTML = '<span style="color:#f87171">Failed to load events. Is the server running?</span>';
    }
  }

  /* ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ */
  function formatDate(dateStr) {
    const d = new Date(dateStr + 'T00:00:00');
    return {
      day: d.getDate(),
      mon: d.toLocaleString('en', { month: 'short' }),
      full: d.toLocaleDateString('en', { weekday:'short', year:'numeric', month:'short', day:'numeric' })
    };
  }

  function highlight(text, q) {
    if (!q) return text;
    const re = new RegExp(`(${q.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')})`, 'gi');
    return text.replace(re, '<mark>$1</mark>');
  }

  function tagClass(cat) {
    return `tag tag-${cat}`;
  }

  /* ‚îÄ‚îÄ Render ‚îÄ‚îÄ */
  function render() {
    const q = query.toLowerCase().trim();
    const filtered = EVENTS.filter(ev => {
    const matchCat = activeFilter === 'all' || ev.eventType === activeFilter;
    const matchQ   = !q ||
      ev.taskName.toLowerCase().includes(q) ||
      ev.location.toLowerCase().includes(q) ||
      ev.eventType.toLowerCase().includes(q);
    return matchCat && matchQ;
  });

    resultsEl.innerHTML = '';

    if (!filtered.length) {
      emptyEl.classList.add('show');
      metaEl.innerHTML = '';
      return;
    }

    emptyEl.classList.remove('show');
    metaEl.innerHTML = `Showing <span>${filtered.length}</span> event${filtered.length !== 1 ? 's' : ''}`;

filtered.forEach((ev, i) => {
      const dateTime = new Date(ev.dateOfTask);
      const d = {
        day: dateTime.getDate(),
        mon: dateTime.toLocaleString('en', { month: 'short' }),
        full: dateTime.toLocaleDateString('en', { weekday:'short', year:'numeric', month:'short', day:'numeric' })
      };
      const time = dateTime.toLocaleTimeString('en', { hour: '2-digit', minute: '2-digit' });

      const card = document.createElement('div');
      card.className = 'event-card';
      card.style.animationDelay = `${i * 0.05}s`;
      card.innerHTML = `
        <div class="date-badge">
          <div class="day">${d.day}</div>
          <div class="mon">${d.mon}</div>
        </div>
        <div class="card-body">
          <div class="event-name">${highlight(ev.taskName, q)}</div>
          <div class="meta-row">
            <span class="meta-item">
              <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
              ${d.full}
            </span>
            <span class="meta-item">
              <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
              ${time}
            </span>
            <span class="meta-item">
              <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>
              ${highlight(ev.location, q)}
            </span>
          </div>
        </div>
        <span class="${tagClass(ev.eventType)}">${ev.eventType}</span>
      `;
      resultsEl.appendChild(card);
    });
  }

  /* ‚îÄ‚îÄ Events ‚îÄ‚îÄ */
  input.addEventListener('input', () => {
    query = input.value;
    clearBtn.classList.toggle('visible', query.length > 0);
    render();
  });

  clearBtn.addEventListener('click', () => {
    input.value = '';
    query = '';
    clearBtn.classList.remove('visible');
    input.focus();
    render();
  });

  document.getElementById('filters').addEventListener('click', e => {
    const chip = e.target.closest('.chip');
    if (!chip) return;
    document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
    chip.classList.add('active');
    activeFilter = chip.dataset.cat;
    render();
  });

  /* Initial load */
  loadEvents();
</script>
</body>
</html>
