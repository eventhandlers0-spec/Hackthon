<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Event Handlers â€” Admin</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:#0a0a0f; --surface:#111118; --surface2:#16161f; --border:#1e1e2e;
    --accent:#7c3aed; --accent2:#06b6d4; --accent3:#f59e0b;
    --text:#e2e8f0; --muted:#64748b; --success:#10b981; --danger:#ef4444;
  }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{background:var(--bg);color:var(--text);font-family:'DM Mono',monospace;min-height:100vh;overflow-x:hidden;}
  body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(124,58,237,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(124,58,237,.03) 1px,transparent 1px);background-size:40px 40px;pointer-events:none;z-index:0;}
  .layout{display:flex;min-height:100vh;position:relative;z-index:1;}

  /* SIDEBAR */
  .sidebar{width:240px;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;flex-shrink:0;position:sticky;top:0;height:100vh;}
  .logo{padding:28px 24px 20px;border-bottom:1px solid var(--border);}
  .logo-mark{font-family:'Syne',sans-serif;font-weight:800;font-size:20px;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
  .logo-sub{font-size:9px;letter-spacing:3px;color:var(--muted);text-transform:uppercase;margin-top:2px;}
  .nav{padding:16px 12px;flex:1;}
  .nav-label{font-size:9px;letter-spacing:2px;color:var(--muted);text-transform:uppercase;padding:0 12px;margin:16px 0 8px;}
  .nav-item{display:flex;align-items:center;gap:12px;padding:10px 12px;border-radius:8px;cursor:pointer;font-size:13px;color:var(--muted);transition:all .15s;border:1px solid transparent;margin-bottom:2px;user-select:none;}
  .nav-item:hover{background:rgba(124,58,237,.08);color:var(--text);border-color:rgba(124,58,237,.2);}
  .nav-item.active{background:rgba(124,58,237,.15);color:var(--text);border-color:rgba(124,58,237,.3);}
  .nav-item .badge{margin-left:auto;background:var(--accent);color:#fff;font-size:9px;padding:2px 6px;border-radius:10px;}
  .nav-icon{font-size:16px;width:20px;text-align:center;}
  .sidebar-footer{padding:16px;border-top:1px solid var(--border);}
  .admin-chip{display:flex;align-items:center;gap:10px;}
  .avatar{width:32px;height:32px;border-radius:8px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:bold;flex-shrink:0;}
  .admin-info{font-size:11px;color:var(--muted);}
  .admin-name{font-size:13px;color:var(--text);font-weight:600;}

  /* MAIN */
  .main{flex:1;overflow-y:auto;display:flex;flex-direction:column;}
  .api-config{background:rgba(124,58,237,.07);border-bottom:1px solid rgba(124,58,237,.2);padding:9px 32px;display:flex;align-items:center;gap:12px;font-size:11px;flex-shrink:0;}
  .api-config label{color:var(--muted);white-space:nowrap;}
  .api-config input{flex:1;max-width:320px;background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:5px 10px;color:var(--text);font-family:'DM Mono',monospace;font-size:11px;outline:none;}
  .api-config input:focus{border-color:var(--accent);}
  .api-dot{width:7px;height:7px;border-radius:50%;background:var(--muted);display:inline-block;transition:background .3s;}
  .api-dot.ok{background:var(--success);animation:pulse 2s infinite;}
  .api-dot.err{background:var(--danger);}
  .topbar{padding:20px 32px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;background:rgba(17,17,24,.8);backdrop-filter:blur(10px);position:sticky;top:0;z-index:10;flex-shrink:0;}
  .page-title{font-family:'Syne',sans-serif;font-weight:700;font-size:22px;letter-spacing:-.5px;}
  .topbar-actions{display:flex;gap:10px;align-items:center;}
  .content{padding:32px;flex:1;}

  /* BUTTONS */
  .btn{padding:8px 16px;border-radius:8px;border:none;cursor:pointer;font-family:'DM Mono',monospace;font-size:12px;font-weight:500;transition:all .15s;letter-spacing:.5px;}
  .btn-primary{background:linear-gradient(135deg,var(--accent),#9d5cf7);color:#fff;box-shadow:0 4px 15px rgba(124,58,237,.3);}
  .btn-primary:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(124,58,237,.4);}
  .btn-primary:disabled{opacity:.6;cursor:not-allowed;transform:none;}
  .btn-ghost{background:transparent;color:var(--muted);border:1px solid var(--border);}
  .btn-ghost:hover{background:var(--surface);color:var(--text);border-color:var(--accent);}
  .btn-danger{background:rgba(239,68,68,.1);color:var(--danger);border:1px solid rgba(239,68,68,.2);}
  .btn-danger:hover{background:rgba(239,68,68,.2);}
  .btn-sm{padding:5px 10px;font-size:11px;}

  /* STATS */
  .stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:32px;}
  .stat-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:20px;position:relative;overflow:hidden;transition:border-color .2s,transform .2s;}
  .stat-card:hover{border-color:var(--accent);transform:translateY(-2px);}
  .stat-card::before{content:'';position:absolute;top:-10px;right:-10px;width:80px;height:80px;border-radius:50%;filter:blur(30px);opacity:.3;}
  .stat-card:nth-child(1)::before{background:var(--accent);}
  .stat-card:nth-child(2)::before{background:var(--accent2);}
  .stat-card:nth-child(3)::before{background:var(--accent3);}
  .stat-card:nth-child(4)::before{background:var(--success);}
  .stat-label{font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:10px;}
  .stat-value{font-family:'Syne',sans-serif;font-size:32px;font-weight:800;line-height:1;margin-bottom:6px;}
  .stat-delta{font-size:11px;color:var(--muted);}

  /* PANELS */
  .panels-grid{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:24px;}
  .panel{background:var(--surface);border:1px solid var(--border);border-radius:12px;overflow:hidden;}
  .panel-full{background:var(--surface);border:1px solid var(--border);border-radius:12px;overflow:hidden;margin-bottom:24px;}
  .panel-header{padding:18px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
  .panel-title{font-family:'Syne',sans-serif;font-weight:700;font-size:14px;letter-spacing:.3px;}
  .panel-count{font-size:11px;color:var(--muted);background:var(--bg);border:1px solid var(--border);border-radius:20px;padding:2px 8px;}

  /* TABLE */
  .table-wrap{overflow-x:auto;}
  .table{width:100%;border-collapse:collapse;}
  .table th{text-align:left;font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--muted);padding:10px 20px;border-bottom:1px solid var(--border);font-weight:400;white-space:nowrap;}
  .table td{padding:14px 20px;font-size:12px;border-bottom:1px solid rgba(30,30,46,.5);white-space:nowrap;}
  .table tr:last-child td{border-bottom:none;}
  .table tr:hover td{background:rgba(124,58,237,.04);}

  /* BADGES */
  .status-badge{font-size:10px;padding:3px 8px;border-radius:20px;font-weight:500;letter-spacing:.5px;}
  .status-live{background:rgba(16,185,129,.12);color:var(--success);border:1px solid rgba(16,185,129,.2);}
  .status-upcoming{background:rgba(6,182,212,.12);color:var(--accent2);border:1px solid rgba(6,182,212,.2);}
  .status-ended{background:rgba(100,116,139,.12);color:var(--muted);border:1px solid rgba(100,116,139,.2);}

  /* USER ROW */
  .user-row{display:flex;align-items:center;gap:12px;}
  .user-avatar{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:600;flex-shrink:0;color:#fff;}
  .user-name{font-size:13px;}
  .user-email{font-size:10px;color:var(--muted);}

  /* MODAL */
  .modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(4px);z-index:100;align-items:center;justify-content:center;}
  .modal-overlay.open{display:flex;animation:fadeIn .2s ease;}
  .modal{background:var(--surface);border:1px solid var(--border);border-radius:16px;width:520px;max-width:92vw;max-height:90vh;overflow-y:auto;animation:slideUp .2s ease;box-shadow:0 25px 60px rgba(0,0,0,.5);}
  .modal-header{padding:24px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;background:var(--surface);z-index:1;}
  .modal-title{font-family:'Syne',sans-serif;font-weight:700;font-size:18px;}
  .close-btn{background:none;border:none;color:var(--muted);cursor:pointer;font-size:22px;line-height:1;padding:4px 8px;border-radius:4px;transition:color .15s;}
  .close-btn:hover{color:var(--text);}
  .modal-body{padding:24px;}
  .form-group{margin-bottom:16px;}
  .form-label{display:block;font-size:10px;letter-spacing:1.5px;text-transform:uppercase;color:var(--muted);margin-bottom:6px;}
  .form-input{width:100%;background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:10px 14px;color:var(--text);font-family:'DM Mono',monospace;font-size:13px;transition:border-color .15s;outline:none;}
  .form-input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(124,58,237,.1);}
  .form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
  .modal-footer{padding:16px 24px;border-top:1px solid var(--border);display:flex;gap:10px;justify-content:flex-end;position:sticky;bottom:0;background:var(--surface);}

  /* VIEWS */
  .view{display:none;}
  .view.active{display:block;animation:fadeIn .25s ease;}

  /* SEARCH */
  .search-bar{background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:8px 14px;color:var(--text);font-family:'DM Mono',monospace;font-size:12px;outline:none;width:220px;transition:border-color .15s;}
  .search-bar:focus{border-color:var(--accent);}

  /* SKELETON */
  .skeleton{background:linear-gradient(90deg,var(--border) 25%,rgba(30,30,46,.8) 50%,var(--border) 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;border-radius:4px;height:14px;margin:4px 0;}

  /* NOTIFICATIONS */
  .notification{position:fixed;bottom:24px;right:24px;background:var(--surface);border:1px solid var(--border);border-left:3px solid var(--success);border-radius:10px;padding:14px 18px;font-size:13px;z-index:200;display:flex;align-items:center;gap:10px;transform:translateY(100px);opacity:0;transition:all .3s cubic-bezier(.34,1.56,.64,1);max-width:300px;}
  .notification.show{transform:translateY(0);opacity:1;}
  .notification.error{border-left-color:var(--danger);}

  /* EMPTY STATE */
  .empty-state{text-align:center;padding:60px 20px;color:var(--muted);}
  .empty-icon{font-size:40px;margin-bottom:12px;}
  .empty-text{font-size:13px;}

  /* LIVE DOT */
  .live-dot{width:6px;height:6px;border-radius:50%;background:var(--success);display:inline-block;margin-right:6px;animation:pulse 2s infinite;}

  @keyframes fadeIn{from{opacity:0}to{opacity:1}}
  @keyframes slideUp{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
  @keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
  @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

  /* RESPONSIVE */
  @media(max-width:900px){
    .sidebar{width:64px;}
    .nav-item span:not(.nav-icon):not(.badge){display:none;}
    .nav-label,.logo-sub,.admin-info,.admin-name{display:none;}
    .logo-mark{font-size:15px;}
    .stats-grid{grid-template-columns:1fr 1fr;}
    .panels-grid{grid-template-columns:1fr;}
  }
  @media(max-width:600px){
    .stats-grid{grid-template-columns:1fr 1fr;}
    .content{padding:16px;}
    .topbar{padding:14px 16px;}
    .api-config{padding:8px 16px;}
    .form-row{grid-template-columns:1fr;}
  }
</style>
</head>
<body>

<div class="layout">

  <!-- â•â• SIDEBAR â•â• -->
  <div class="sidebar">
    <div class="logo">
      <div class="logo-mark">Event Handlers</div>
      <div class="logo-sub">Admin Panel</div>
    </div>
    <nav class="nav">
      <div class="nav-label">Overview</div>
      <div class="nav-item active" onclick="switchView('dashboard',this)">
        <span class="nav-icon">âš¡</span><span>Dashboard</span>
      </div>
      <div class="nav-label">Manage</div>
      <div class="nav-item" onclick="switchView('events',this)">
        <span class="nav-icon">ðŸ“…</span><span>Events</span>
        <span class="badge" id="badge-events">0</span>
      </div>
      <div class="nav-item" onclick="switchView('users',this)">
        <span class="nav-icon">ðŸ‘¥</span><span>Users</span>
        <span class="badge" id="badge-users">0</span>
      </div>
    </nav>
    <div class="sidebar-footer">
      <div class="admin-chip">
        <div class="avatar">A</div>
        <div>
          <div class="admin-name">Admin</div>
          <div class="admin-info">Super user</div>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â• MAIN â•â• -->
  <div class="main">

    <!-- API Config Bar -->
    <div class="api-config">
      <label>ðŸ”Œ API:</label>
      <input type="text" id="api-base-url" value="https://hackthonbackend.onrender.com" placeholder="https://hackthonbackend.onrender.com">
      <div class="api-dot" id="api-dot"></div>
      <span id="api-status-text" style="color:var(--muted)">Connectingâ€¦</span>
      <button class="btn btn-ghost" style="padding:4px 12px;font-size:11px" onclick="initData()">â†º Reload</button>
    </div>

    <!-- Topbar -->
    <div class="topbar">
      <div class="page-title" id="page-title">Dashboard</div>
      <div class="topbar-actions">
        <input class="search-bar" type="text" id="global-search" placeholder="Searchâ€¦" oninput="onSearch(this.value)">
        <button class="btn btn-primary" id="add-btn" onclick="openAddModal()">+ Add Event</button>
      </div>
    </div>

    <div class="content">

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           DASHBOARD VIEW
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="view active" id="view-dashboard">
        <!-- Stats -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Total Events</div>
            <div class="stat-value" id="stat-events">â€”</div>
            <div class="stat-delta">All registered events</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Total Users</div>
            <div class="stat-value" id="stat-users">â€”</div>
            <div class="stat-delta">Registered accounts</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Upcoming</div>
            <div class="stat-value" id="stat-upcoming">â€”</div>
            <div class="stat-delta">Events in the future</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Past Events</div>
            <div class="stat-value" id="stat-past">â€”</div>
            <div class="stat-delta">Completed events</div>
          </div>
        </div>

        <!-- Panels -->
        <div class="panels-grid">
          <div class="panel">
            <div class="panel-header">
              <div class="panel-title">Recent Events</div>
              <button class="btn btn-ghost btn-sm" onclick="switchView('events', document.querySelector('[onclick*=events]'))">View all</button>
            </div>
            <div class="table-wrap">
              <table class="table">
                <thead><tr><th>Event</th><th>Date</th><th>Status</th></tr></thead>
                <tbody id="dash-events-body">
                  <tr><td colspan="3"><div class="skeleton"></div></td></tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="panel">
            <div class="panel-header">
              <div class="panel-title">Recent Users</div>
              <button class="btn btn-ghost btn-sm" onclick="switchView('users', document.querySelector('[onclick*=users]'))">View all</button>
            </div>
            <div class="table-wrap">
              <table class="table">
                <thead><tr><th>User</th><th>Location</th></tr></thead>
                <tbody id="dash-users-body">
                  <tr><td colspan="2"><div class="skeleton"></div></td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           EVENTS VIEW
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="view" id="view-events">
        <div class="panel-full">
          <div class="panel-header">
            <div class="panel-title">All Events <span class="panel-count" id="events-count">0</span></div>
          </div>
          <div class="table-wrap">
            <table class="table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Event Name</th>
                  <th>Date</th>
                  <th>Notify Gap</th>
                  <th>Notify At</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="events-body">
                <tr><td colspan="7"><div class="skeleton"></div></td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           USERS VIEW
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="view" id="view-users">
        <div class="panel-full">
          <div class="panel-header">
            <div class="panel-title">All Users <span class="panel-count" id="users-count">0</span></div>
          </div>
          <div class="table-wrap">
            <table class="table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>User</th>
                  <th>Email</th>
                  <th>Location</th>
                </tr>
              </thead>
              <tbody id="users-body">
                <tr><td colspan="4"><div class="skeleton"></div></td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div><!-- /content -->
  </div><!-- /main -->
</div><!-- /layout -->

<!-- â•â• ADD EVENT MODAL â•â• -->
<div class="modal-overlay" id="add-event-modal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Add New Event</div>
      <button class="close-btn" onclick="closeModal('add-event-modal')">Ã—</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Event / Task Name</label>
        <input class="form-input" id="f-taskName" placeholder="e.g. Tech Conference 2025">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Date of Task</label>
          <input class="form-input" type="datetime-local" id="f-dateOfTask">
        </div>
        <div class="form-group">
          <label class="form-label">Gap for Notifications</label>
          <input class="form-input" id="f-gapForNotifications" placeholder="e.g. 30 (minutes)">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">When to Notify</label>
        <input class="form-input" type="datetime-local" id="f-whenToNotify">
      </div>
      <div id="add-error" style="color:var(--danger);font-size:12px;margin-top:8px;display:none;"></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('add-event-modal')">Cancel</button>
      <button class="btn btn-primary" id="add-submit-btn" onclick="submitAddEvent()">Create Event</button>
    </div>
  </div>
</div>

<!-- â•â• DELETE CONFIRM MODAL â•â• -->
<div class="modal-overlay" id="delete-modal">
  <div class="modal" style="max-width:380px;">
    <div class="modal-header">
      <div class="modal-title">Delete Event</div>
      <button class="close-btn" onclick="closeModal('delete-modal')">Ã—</button>
    </div>
    <div class="modal-body">
      <p style="font-size:13px;color:var(--muted);line-height:1.6;">Are you sure you want to delete <strong id="delete-event-name" style="color:var(--text)"></strong>? This action cannot be undone.</p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('delete-modal')">Cancel</button>
      <button class="btn btn-danger" id="confirm-delete-btn" onclick="confirmDelete()">Delete</button>
    </div>
  </div>
</div>

<script>
  // â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const BASE_URL = 'https://hackthonbackend.onrender.com';
  const getBase  = () => document.getElementById('api-base-url').value.replace(/\/+$/,'');

  let allEvents = [];
  let allUsers  = [];
  let currentView = 'dashboard';
  let deleteTarget = null;

  // â”€â”€ API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function apiFetch(path, opts = {}) {
    const res = await fetch(getBase() + path, {
      headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
      ...opts
    });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    if (res.status === 204) return null;
    const txt = await res.text();
    return txt ? JSON.parse(txt) : null;
  }

  // â”€â”€ API STATUS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function setApiStatus(ok) {
    const dot  = document.getElementById('api-dot');
    const text = document.getElementById('api-status-text');
    if (ok) {
      dot.className = 'api-dot ok';
      text.textContent = 'Connected';
      text.style.color = '#10b981';
    } else {
      dot.className = 'api-dot err';
      text.textContent = 'Error';
      text.style.color = '#ef4444';
    }
  }

  // â”€â”€ LOAD EVENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadEvents() {
    try {
      const data = await apiFetch('/Event/allEvents');
      allEvents = Array.isArray(data) ? data : [];
      setApiStatus(true);
    } catch (e) {
      setApiStatus(false);
      notify('Failed to load events', true);
      allEvents = [];
    }
    renderEvents();
    renderDashEvents();
    updateStats();
  }

  // â”€â”€ LOAD USERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadUsers() {
    try {
      const data = await apiFetch('/getAllCustomers');
      allUsers = Array.isArray(data) ? data : [];
    } catch (e) {
      notify('Failed to load users', true);
      allUsers = [];
    }
    renderUsers();
    renderDashUsers();
    updateStats();
  }

  // â”€â”€ ADD EVENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function submitAddEvent() {
    const errEl  = document.getElementById('add-error');
    const btnEl  = document.getElementById('add-submit-btn');
    const name   = document.getElementById('f-taskName').value.trim();
    const date   = document.getElementById('f-dateOfTask').value;
    const gap    = document.getElementById('f-gapForNotifications').value.trim();
    const notify_ = document.getElementById('f-whenToNotify').value;

    if (!name || !date) {
      errEl.textContent = 'Event name and date are required.';
      errEl.style.display = 'block';
      return;
    }
    errEl.style.display = 'none';
    btnEl.disabled = true;
    btnEl.textContent = 'Creatingâ€¦';

    const payload = {
      taskName: name,
      dateOfTask: date,
      gapForNotifications: gap,
      whenToNotify: notify_
    };

    try {
      await apiFetch('/Event/addEvent', { method: 'POST', body: JSON.stringify(payload) });
      notify('Event added successfully âœ“');
      closeModal('add-event-modal');
      clearAddForm();
      loadEvents();
    } catch (e) {
      errEl.textContent = 'Failed to add event. ' + e.message;
      errEl.style.display = 'block';
      notify('Failed to add event', true);
    }
    btnEl.disabled = false;
    btnEl.textContent = 'Create Event';
  }

  function clearAddForm() {
    ['f-taskName','f-dateOfTask','f-gapForNotifications','f-whenToNotify'].forEach(id => {
      document.getElementById(id).value = '';
    });
    document.getElementById('add-error').style.display = 'none';
  }

  // â”€â”€ DELETE EVENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openDeleteModal(event) {
    deleteTarget = event;
    document.getElementById('delete-event-name').textContent = event.taskName || event.name || 'this event';
    openModal('delete-modal');
  }

  async function confirmDelete() {
    if (!deleteTarget) return;
    const btn = document.getElementById('confirm-delete-btn');
    btn.disabled = true;
    btn.textContent = 'Deletingâ€¦';

    // Try common delete endpoint patterns
    const id = deleteTarget.id || deleteTarget.eventId || deleteTarget._id;
    try {
      await apiFetch(`/Event/delete/${id}`, { method: 'DELETE' });
      notify('Event deleted');
      closeModal('delete-modal');
      loadEvents();
    } catch (e) {
      notify('Delete failed: ' + e.message, true);
    }
    btn.disabled = false;
    btn.textContent = 'Delete';
    deleteTarget = null;
  }

  // â”€â”€ RENDER EVENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderEvents(filter = '') {
    const body  = document.getElementById('events-body');
    const count = document.getElementById('events-count');
    let list = allEvents;
    if (filter) list = list.filter(e => JSON.stringify(e).toLowerCase().includes(filter.toLowerCase()));
    count.textContent = list.length;
    document.getElementById('badge-events').textContent = allEvents.length;

    if (!list.length) {
      body.innerHTML = `<tr><td colspan="7"><div class="empty-state"><div class="empty-icon">ðŸ“­</div><div class="empty-text">No events found</div></div></td></tr>`;
      return;
    }
    body.innerHTML = list.map((e, i) => {
      const dateStr = e.dateOfTask || e.date || e.eventDate || 'â€”';
      const status  = getEventStatus(dateStr);
      return `<tr>
        <td style="color:var(--muted)">${i+1}</td>
        <td><strong>${esc(e.taskName || e.name || 'Unnamed')}</strong></td>
        <td>${formatDate(dateStr)}</td>
        <td>${esc(String(e.gapForNotifications ?? 'â€”'))}</td>
        <td>${formatDate(e.whenToNotify || 'â€”')}</td>
        <td><span class="status-badge ${status.cls}">${status.label}</span></td>
        <td>
          <button class="btn btn-danger btn-sm" onclick='openDeleteModal(${JSON.stringify(e)})'>Delete</button>
        </td>
      </tr>`;
    }).join('');
  }

  // â”€â”€ RENDER USERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderUsers(filter = '') {
    const body  = document.getElementById('users-body');
    const count = document.getElementById('users-count');
    let list = allUsers;
    if (filter) list = list.filter(u => JSON.stringify(u).toLowerCase().includes(filter.toLowerCase()));
    count.textContent = list.length;
    document.getElementById('badge-users').textContent = allUsers.length;

    if (!list.length) {
      body.innerHTML = `<tr><td colspan="4"><div class="empty-state"><div class="empty-icon">ðŸ‘¤</div><div class="empty-text">No users found</div></div></td></tr>`;
      return;
    }
    const colors = ['#7c3aed','#06b6d4','#f59e0b','#10b981','#ef4444','#8b5cf6'];
    body.innerHTML = list.map((u, i) => {
      const name  = u.username || u.name || 'User';
      const email = u.email || 'â€”';
      const loc   = u.location || 'â€”';
      const color = colors[i % colors.length];
      return `<tr>
        <td style="color:var(--muted)">${i+1}</td>
        <td>
          <div class="user-row">
            <div class="user-avatar" style="background:${color}">${name.charAt(0).toUpperCase()}</div>
            <div>
              <div class="user-name">${esc(name)}</div>
            </div>
          </div>
        </td>
        <td style="color:var(--muted)">${esc(email)}</td>
        <td style="color:var(--muted)">${esc(loc)}</td>
      </tr>`;
    }).join('');
  }

  // â”€â”€ DASHBOARD MINI TABLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderDashEvents() {
    const body = document.getElementById('dash-events-body');
    const list = allEvents.slice(0, 5);
    if (!list.length) {
      body.innerHTML = `<tr><td colspan="3"><div class="empty-state" style="padding:20px"><div class="empty-text">No events yet</div></div></td></tr>`;
      return;
    }
    body.innerHTML = list.map(e => {
      const dateStr = e.dateOfTask || e.date || 'â€”';
      const status  = getEventStatus(dateStr);
      return `<tr>
        <td>${esc(e.taskName || e.name || 'Unnamed')}</td>
        <td style="color:var(--muted)">${formatDate(dateStr)}</td>
        <td><span class="status-badge ${status.cls}">${status.label}</span></td>
      </tr>`;
    }).join('');
  }

  function renderDashUsers() {
    const body = document.getElementById('dash-users-body');
    const list = allUsers.slice(0, 5);
    const colors = ['#7c3aed','#06b6d4','#f59e0b','#10b981','#ef4444'];
    if (!list.length) {
      body.innerHTML = `<tr><td colspan="2"><div class="empty-state" style="padding:20px"><div class="empty-text">No users yet</div></div></td></tr>`;
      return;
    }
    body.innerHTML = list.map((u, i) => {
      const name = u.username || u.name || 'User';
      const loc  = u.location || 'â€”';
      const color = colors[i % colors.length];
      return `<tr>
        <td>
          <div class="user-row">
            <div class="user-avatar" style="background:${color};width:28px;height:28px;font-size:11px">${name.charAt(0).toUpperCase()}</div>
            <span>${esc(name)}</span>
          </div>
        </td>
        <td style="color:var(--muted)">${esc(loc)}</td>
      </tr>`;
    }).join('');
  }

  // â”€â”€ STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function updateStats() {
    document.getElementById('stat-events').textContent   = allEvents.length;
    document.getElementById('stat-users').textContent    = allUsers.length;

    const now = Date.now();
    const upcoming = allEvents.filter(e => {
      const d = new Date(e.dateOfTask || e.date || 0);
      return d.getTime() > now;
    }).length;
    const past = allEvents.length - upcoming;

    document.getElementById('stat-upcoming').textContent = upcoming;
    document.getElementById('stat-past').textContent     = past;
  }

  // â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function esc(str) {
    return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }

  function formatDate(str) {
    if (!str || str === 'â€”') return 'â€”';
    const d = new Date(str);
    if (isNaN(d)) return str;
    return d.toLocaleDateString('en-GB', { day:'2-digit', month:'short', year:'numeric', hour:'2-digit', minute:'2-digit' });
  }

  function getEventStatus(dateStr) {
    if (!dateStr || dateStr === 'â€”') return { cls: 'status-ended', label: 'Unknown' };
    const d = new Date(dateStr);
    if (isNaN(d)) return { cls: 'status-ended', label: 'Unknown' };
    const diff = d.getTime() - Date.now();
    if (diff > 86400000)  return { cls: 'status-upcoming', label: 'Upcoming' };
    if (diff > 0)         return { cls: 'status-live',     label: 'âš¡ Today'  };
    return                       { cls: 'status-ended',    label: 'Past'      };
  }

  // â”€â”€ SEARCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function onSearch(val) {
    if (currentView === 'events') renderEvents(val);
    if (currentView === 'users')  renderUsers(val);
  }

  // â”€â”€ MODALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openModal(id) {
    document.getElementById(id).classList.add('open');
  }
  function closeModal(id) {
    document.getElementById(id).classList.remove('open');
  }
  function openAddModal() {
    clearAddForm();
    openModal('add-event-modal');
  }

  // Close on overlay click
  document.querySelectorAll('.modal-overlay').forEach(el => {
    el.addEventListener('click', e => {
      if (e.target === el) el.classList.remove('open');
    });
  });

  // â”€â”€ VIEW SWITCHING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function switchView(name, navEl) {
    currentView = name;
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
    document.getElementById('view-' + name).classList.add('active');
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    if (navEl) navEl.classList.add('active');
    document.getElementById('page-title').textContent =
      name === 'dashboard' ? 'Dashboard' :
      name === 'events'    ? 'Events'    : 'Users';
    document.getElementById('add-btn').style.display = name === 'events' ? 'inline-block' : 'none';
    document.getElementById('global-search').value = '';
    renderEvents();
    renderUsers();
  }

  // Initial add btn state
  document.getElementById('add-btn').style.display = 'none';

  // â”€â”€ NOTIFICATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function notify(msg, isErr = false) {
    const n = document.createElement('div');
    n.className = 'notification' + (isErr ? ' error' : '');
    n.textContent = msg;
    document.body.appendChild(n);
    setTimeout(() => n.classList.add('show'), 50);
    setTimeout(() => {
      n.classList.remove('show');
      setTimeout(() => n.remove(), 300);
    }, 3000);
  }

  // â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function initData() {
    setApiStatus(false);
    document.getElementById('api-status-text').textContent = 'Connectingâ€¦';
    document.getElementById('api-status-text').style.color = 'var(--muted)';
    await loadUsers();
    await loadEvents();
  }

  window.onload = initData;
</script>
</body>
</html>
